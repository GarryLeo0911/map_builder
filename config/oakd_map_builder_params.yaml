point_cloud_processor:
  ros__parameters:
    voxel_size: 0.03  # Smaller voxel size for better detail
    max_range: 8.0    # Reduced range for indoor mapping
    min_range: 0.2    # Slightly reduced min range
    statistical_outlier_nb_neighbors: 15
    statistical_outlier_std_ratio: 1.5
    buffer_size: 50   # Smaller buffer for faster processing
    
    # Enhanced filtering
    enable_bilateral_filter: false  # Disable for performance
    enable_ground_removal: true
    ground_threshold: 0.3
    enable_radius_outlier_removal: true
    radius_search: 0.1
    min_neighbors_radius: 5
    
    # Registration parameters - reduce crashes
    enable_registration: true
    registration_max_correspondence_distance: 0.1
    registration_max_iterations: 30  # Reduced iterations
    registration_transformation_epsilon: 1e-6
    registration_euclidean_fitness_epsilon: 1e-6
    
    # Adaptive voxel sizing
    adaptive_voxel_size: true
    min_voxel_size: 0.01
    max_voxel_size: 0.05
    target_points_per_cloud: 3000  # Reduced target for performance

visual_odometry:
  ros__parameters:
    voxel_size: 0.02
    max_correspondence_distance: 0.05
    max_iterations: 50
    transformation_epsilon: 1e-6
    euclidean_fitness_epsilon: 1e-6
    max_translation: 0.5      # Max movement per frame (meters)
    max_rotation: 0.5         # Max rotation per frame (radians)
    enable_normal_estimation: false
    normal_search_radius: 0.03
    use_gicp: true           # Use GICP for better accuracy
    fitness_score_threshold: 0.3

surface_reconstructor:
  ros__parameters:
    mesh_resolution: 0.08
    clustering_tolerance: 0.15
    clustering_min_cluster_size: 30
    clustering_max_cluster_size: 50000
    convex_hull_alpha: 0.1
    
    # Normal estimation parameters - use K search, set radius to 0
    normal_search_radius: 0.0  # Set to 0 to use K search instead
    normal_k_search: 20
    
    # Enhanced surface reconstruction
    reconstruction_method: "greedy_projection"  # More stable than poisson
    enable_region_growing: false  # Disable to reduce complexity
    
    # Greedy projection parameters
    gp3_search_radius: 0.2
    gp3_mu: 2.5
    gp3_max_nearest_neighbors: 100

map_builder_node:
  ros__parameters:
    map_resolution: 0.05
    map_width: 800     # Larger map for better coverage
    map_height: 800
    map_origin_x: -20.0
    map_origin_y: -20.0
    robot_radius: 0.25
    min_obstacle_height: 0.05  # Lower threshold for small obstacles
    max_obstacle_height: 2.5   # Higher threshold for ceiling detection